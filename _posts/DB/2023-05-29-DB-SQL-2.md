---
title: "[DB]SQL(2)"
excerpt: "SQL"

categories:
  - DB
tags:
  - [데이터베이스, SQL]

toc: true
toc_sticky: true

date: 2023-05-29
---

## 📚데이터 조작 언어
데이터 조작 언어(DML)는 스키마 내의 데이터에 여러 연산을 수행하기 위한 명령어의 집합을 의미합니다. DML을 사용하여 데이터를 삽입, 삭제, 수정, 검색할 수 있습니다. 데이터 조작 언어는 기능에 따라 네 가지 명령어로 나눌 수 있습니다.

* INSERT: 테이블 스키마에 새로운 레코드를 삽입

* UPDATE: 테이블에서 조건을 만족하는 특정 레코드의 컬럼 값을 수정

* DELETE: 테이블에서 조건을 만족하는 특정 레코드를 삭제

* SELECT: 테이블에 존재하는 레코드 중 주어진 조건을 만족하는 레코드를 검색

<br>

### 📄INSERT 문
INSERT문은 테이블에 새로운 레코드를 추가할 때 사용하는 명령어입니다. 레코드를 삽입할 때 테이블 내에 있는 모든 컬럼값을 입력하거나 몇몇 컬럼만 선택적으로 입력할 수 있습니다. 컬럼에 대한 값의 순서는 정의된 테이블 스키마의 컬럼 순서와 반드시 일치해야 하고 데이터 타입에 맞는 값을 입력해야 합니다. 컬럼값이 문자나 날짜인 경우 작은따옴표를 붙입니다.

```sql
INSERT INTO 테이블이름
  VALUES(v1, v2, ... vn)

-- 또는

INSERT INTO 테이블이름(컬럼1, 컬럼2, ..., 컬럼m)
  VALUES(v1, v2, ... vm)
```

<br><br>

### 📄UPDATE 문
UPDATE문은 테이블에 저장된 레코드에 대한 컬럼 값을 변경하기 위해 사용하는 명령어입니다. 일부 레코드에 대해서만 값을 변경하려고 한다면 WHERE절을 사용합니다.

```sql
UPDATE 테이블이름
  SET 컬럼1 = 값1[컬럼2=값2, ..., 컬럼n=값n]
  [WHERE 조건]
```

<br>

```sql
UPDATE 학생
  SET 나이 = 나이 + 1;
SELECT * FROM 학생;
```

WHERE 절이 없는 UPDATE 문의 경우 전체 레코드를 대상으로 수정하는 것이라서 MySQL이 실행을 거부합니다. 불가피하게 WHERE 조건이 없는 UPDATE 문을 사용하려면 SAFE UPDATES 모드를 비활성화하고 사용해야 합니다.

<br><br>

### 📄DELETE 문
DELETE문은 레코드 단위로만 삭제할 수 있습니다. 특정 컬럼의 값만 선택적으로 삭제할 수 없습니다. 특정 컬럼 값을 삭제하고 싶다면 UPDATE문을 사용해 NULL값으로 대체가 가능합니다.

```sql
DELETE FROM 테이블이름
  [WHERE 조건]
```

UPDATE 문과 마찬가지로 WHERE 절이 없는 DELETE 문은 전체 레코드를 삭제하는 것이라서 MySQL이 실행을 거부합니다. 따라서 불가피하게 WHERE 조건이 없는 DELETE 문을 사용하려면 SAFE UPDATES 모드를 비활성화하고 사용해야 합니다.

<br><br>

### 📄SELECT 문
SELECT 문은 한 개 또는 그 이상의 테이블에서 필요한 데이터를 검색하는데 사용하는 명령어입니다. 이 명령어는 복잡한 업무를 처리하기 위해 필요한 데이터를 검색할 수 있게 다양한 절을 가지고 있습니다. 아래 SELECT 문을 보면 SELECT 절만 필수적이고 나머지 절은 모두 선택적으로 적용할 수 있습니다.

```sql
SELECT [DISTINCT]컬럼1, 컬러2, ..., 컬럼x
  [FROM 테이블 [INNER JOIN|OUTER JOIN|CROSS JOIN
        테이블 INNER JOIN|OUTER JOIN|CROSS JOIN
        ON 조인 조건식1
        테이블 INNER JOIN|OUTER JOIN|CROSS JOIN
        ...
        테이블m
        ON 조인 조건식]]
  [ON 조인 조건식]
  [WHERE 조건[중첩질의]]
  [GROUP BY 컬럼1, 컬럼2, ..., 컬럼y
    [HAVING 조건]]
  [ORDER BY 컬럼1[ASC|DESC], ..., 컬럼z[ASC|DESC]]
```

* SELECT 절
<br>
SELECT 절은 질의 결과에 포함되는 컬럼을 지정합니다. 관계대수에서 프로젝션 연산자와 같습니다. 질의 결과 중복된 값이 있다면 DISTINCT 키워드를 사용하여 중복 값들을 제거할 수 있습니다.

* FROM 절
<br>
FROM 절은 질의를 적용할 테이블을 지정합니다. 2개 이상의 테이블을 기술하고 그 사이에 CROSS JOIN을 사용할 경우 테이블에 존재하는 모든 레코드를 조합하여 연결하는 카티션 프로덕트가 수행됩니다. INNER JOIN, OUTER JOIN 등을 ON 절에 조건과 함께 사용하면 내/외부 조인 연산을 수행할 수 있습니다. 각 테이블에 별칭을 사용하여 테이블 이름을 간결한 이름으로 사용할 수 있습니다.

* ON 절
<br>
ON 절은 조인 연산 시 테이블 간의 조인 방법을 기술합니다. 보통 기본키-외래키 참조관계를 나타내 관련 있는 레코드를 연결합니다. 비교 연산자를 사용하여 비동등조인으로도 활용 할 수 있습니다.

* WHERE 절
<br>
WHERE 절은 레코드에 대한 특정 검색 조건을 기술할 때 사용합니다. 조건문에 컬럼 이름과 같이 산술 연산자, 비교 연산자, 논리 연산자 등의 연산자들이 사용될 수 있습니다. ON 절은 조인 연산에 대한 조건만 나타내고 WHERE 절은 레코드를 선택하기 위하여 사용된다는 점에서 ON 절과 다릅니다.

* GROUP BY 절
<br>
GROUP BY 절은 특정 컬럼을 기준으로 동일한 값끼리 그룹으로 묶어 요약된 결과를 검색할 수 있게 합니다. 집계함수가 사용됩니다.

* HAVING 절
<br>
GROUP BY에 의해 묶인 그룹 내에서 조건을 주어 검색하고자 할 때 사용됩니다. ON 절은 조인에 대한 조건, WHERE 절은 레코드에 대한 조건, HAVING 절은 GROUP BY 절에 의한 그룹에 대한 조건문이라고 할 수 있습니다.

* ORDER BY 절
<br>
ORDER BY 절은 검색 결과를 특정 칼럼을 기준으로 오름차순(ASC), 내림차순(DESC)으로 정렬하여 출력할 때 사용합니다.

<br>

📌단순질의문
<br>
가장 단순한 형태의 SELECT 문입니다.

```sql
SELECT 컬럼1, 컬럼2, ..., 컬럼n
  FROM 테이블이름
```

<br>

테이블의 모든 컬럼을 출력할 때는 아래와 같은 SELECT 절을 사용합니다.

```sql
-- * 기호는 모든(all)을 의미
SELECT *
  FROM 테이블이름
```

<br>

📌조건질의문
<br>
테이블에서 조건을 만족하는 일부 레코드만 선택적으로 검색할 때 사용하는 SELECT 문입니다.

```sql
SELECT 컬럼1, 컬럼2, ..., 컬럼n
  FROM 테이블이름
  WHERE 검색조건
```

SELECT 문에는 아래와 같은 연산자들을 사용할 수 있습니다.

* 산술 연산자
* 비교 연산자
* 논리 연산자

<br><br>

### 📄데이터 정렬
MySQL은 데이터 정렬에 대한 명령이 없는 경우 테이블에 지정된 기본키 값의 순서대로 결과를 출력합니다. 상황에 따라 레코드의 출력 순서를 바꾸고 싶다면 ORDER BY 절에서 컬럼 뒤에 ASC(오름차순) 또는 DESC(내림차순) 정렬을 지정하여 결과 출력 순서를 바꿀 수 있습니다. 컬럼 이름만 쓰고 정렬 방향을 지정하지 않으면 기본으로 오름차순 정렬이 수행됩니다.

📍학생 정보를 성별 기준으로 내림차순, 생년월일 기준으로 오른차순 정렬하시오.

```sql
SELECT * FROM 학생
  ORDER BY 성별 DESC, 생년월일 ASC;
```

<br><br>

### 📄집합 연산이 포함된 SELECT
집합 연산 UNION, INTERSECT, EXCEPT는 각각 관계 대수 합집합, 교집합, 차집합에 대응하는 연산입니다. 집합 연산 사용 시 반드시 두 SELECT 문의 결과 스키마가 동일해야 합니다. MySQL에서는 INTERSECT와 EXCEPT 연산을 지원하지 않습니다. UION 연산은 여러 SELECT 문의 결과를 합할 때 사용하며 중복되는 레코드들은 제거됩니다. 중복을 허용하고 싶으면 UNION ALL을 사용하면 됩니다.

```sql
SELECT 문1 UNION | UNION ALL SELECT 문2
```

<br>

📍과목 테이블에서 데이터베이스시스템을 강의하는 교수의 교수번호와 디지털 논리회로를 강의하는 교수의 교수번호를 출력하시오.

```sql
(SELECT 교수번호
  FROM 과목
  WHERE 과목명 = '데이터베이스 시스템')
UNION
(SELECT 교수번호
  FROM 과목
  WHERE 과목명 = '디지털 논리회로')
```


<br><br>

### 📄특수 연산자를 사용한 SELECT
* 범위조건
<br>
지정한 범위의 조건을 만족하는 레코드를 검색하는 경우 BETWEEN 연산자를 사용합니다.

```sql
SELECT 컬럼1, 컬럼2, ..., 컬럼n
  FROM 테이블이름
  WHERE 컬럼i BETWEEN 값1 AND 값2
```

<br>

* 포함/불포함 조건
<br>
IN과 NOT IN 연산자는 컬럼 값이 연산자에서 제시된 값 중 하나와 일치하는지 검사하는 기능을 수행합니다. IN 연산자는 기술한 값 중 하나와 일치하면 참을 반환하고 NOT IN은 거짓을 반환합니다.

```sql
SELECT 컬럼1, 컬럼2, ..., 컬럼n
  FROM 테이블이름
  WHERE 컬럼n IN | NOT IN(값1, 값2, ..., 값m)
```

<br>

* 부분 일치 검색
<br>
SQL은 문자열에 다양한 형태의 검색을 수행할 수 있는 연산을 지원합니다. 완전 일치 검색 뿐만 아니라 LIKE 연산자를 사용하여 전체 컬럼 값 중 일부분만 일치하는 레코드를 검색할 수 있습니다. 이런 검색을 부분 일치 검색이라고 합니다. 부분 일치 검색은 와일드 카드라는 특수 기호를 사용하여 나타낼 수 있습니다.

  - %: 어떤 문자열과도 일치
  - _: 어떤 문자와도 일치
  - '김%': '김'으로 시작하는 어떤 문자열과도 일치
  - '%터%': '컴퓨터', '데이터'와 같이 '터'를 포함하는 어떤 문자열과도 일치
  - '--': 두 개의 문자로 이루어진 모든 문자열과 일치
  - '__%': 세 문자 이상으로 이루어진 모든 문자열과 일치


<br><br>

### 📄기타 SELECT
* 별칭
<br>
별칭은 SQL 문 내부에서 테이블이나 컬럼의 이름을 임시로 변경할 때 사용합니다.

```sql
변경전 이름 [AS] 변경후 이름
```

<br>

* NULL 값
<br>
DBMS는 NULL 개념을 지원합니다. NULL은 알 수 없는 값, 적용할 수 없는 값을 나타내는 특수 문자입니다. NULL 값을 검색하려면 IS NULL을 사용하고 NULL이 아닌 값을 검색하려면 IS NOT NULL 키워드를 사용합니다.

📍이수학점이 미정인 학생을 출력하시오.

```sql
SELECT * FROM 전공
  WHERE 이수학점 IS NULL
```

<br>

* 함수 활용
<br>

  - 숫자 관련 함수

  | 함수명 | 기능 |
  | :---: | :---: |
  | ABS(x) | x의 절대값 |
  | CEILING(x) | x보다 큰 정수중 가장 작은 값 |
  | FLOOR(x) | x보다 작은 정수 중 가장 큰 값 |
  | ROUND(x, y) | x의 소수점 y 이하 자릿수에서 반올림을 적용한 값 |
  | TRUNCATE(x, y) | x의 소수점 y 이하 자릿수에서 버림을 적용한 값 |
  | POWER(x, y) | x<sup>y</sup> 값 |
  | MOD(x, y) | x를 y로 나눈 값의 나머지 |
  
  <br>

  - 문자 관련 함수

  | 함수명 | 기능 |
  | :---: | :---: |
  | ASCII(s) | 문자열 s의 맨 왼쪽 문자의 ASCII 코드 값 반환 |
  | CONCAT(s1, s2, ...) | 입력된 문자열을 연결한 값을 반환 |
  | CHAR_LENGTH(x) | 문자열 s를 구성하는 문자수를 반환 |
  | INSERT(s1, x, y, s2) | 문자열의 s1의 x번째 문자부터 y길이만큼 문자열 s2로 대체한 값을 반환 |
  | REPLACE(s1, s2, s3) | 문자열 s1 내의 s2를 s3로 대체한 값을 반환 |
  | UPPER(s) | 문자열 s의 모든 문자를 대문자로 변환 |
  | SUBSTRING(s, x) | 문자열 s의 x부터의 문자열을 반환 |
  | STRCMP(s1, s2) | s1과 s2 문자열을 비교하여 -1, 0, 1 반환<br>s1 < s2인 경우 -1 반환<br>s1 > s2인 경우 1 반환<br>s1 == s2인 경우 0 반환 |
  
  <br>

  - 날짜 관련 함수

  | 함수명 | 기능 |
  | :---: | :---: |
  | ADDDATE(date, INTERVAL t) | 날짜에 t만큼의 초, 분, 시, 일, 월, 혹은 년 수를 더한 날짜를 반환 |
  | SUBDATE(date, INTERVAL t) | 날짜에 t만큼의 초, 분, 시, 일, 월, 혹은 년 수를 뺀 날짜를 반환 |
  | CURDATE() | 현재 날짜의 값을 반환 |
  | CURTIME() | 현재 시간의 값을 반환 |
  | NOW() | 현재의 날짜와 시간 값을 반환 |
  | DATE() | DATE TIME 형태로 입력 된 값의 DATE 부분만 반환 |
  | HOUR() | TIME 유형의 값으로부터 HOUR 추출 |
  | TIMESTAMPDIFF(type, t1, t2) | t2 - t1의 값을 시간 type에 따라 변환 |
  | TO_SECONDS(t) | 입력된 시간 데이터 t를 초로 변환 |

<br><br>